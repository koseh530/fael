<!DOCTYPE html>
<html>
<head>
  <title>JSON 불러오기</title>
  <link rel="icon" href="icon2h.png">
  <style type="text/CSS">
  h1{
    border-bottom: 1px solid grey;
    padding-bottom: 15px;
  }
  h2{
    border-bottom: 1px solid grey;
    padding-bottom: 15px;
    margin-top: 50px;
  }
  .c-all{
    padding: 20px;
  }
  .c-button{
    background-color: black;
    color: yellow;
    border: none;
    padding: 8px;
    font-size: 16px;
    width: 120px;
    margin-left: 5px;
  }
  table{
    border: 2px solid black;
    border-collapse: collapse;
  }
  thead{
    border: 2px solid black;
  }
  th, td{
    border: 1px solid gray;
    padding: 5px;
  }
  .td1{
    text-align: right;
  }
  .td2{
    padding-right: 20px;
  }

  </style>
</head>

<body>
  <div class="c-all">
    <div>
      <button id="box2001" class="c-button">2020년 1월</button>
      <button id="box2002" class="c-button">2020년 2월</button>
    </div>
    <br>
    <div class="c-paragraph"></div>
  </div>
  <script type="text/javascript">

  document.querySelector("#box2001").addEventListener("click", function(){
    let jf = "20200101.json"
    loadDoc(jf);
  }, false);

  document.querySelector("#box2002").addEventListener("click", function(){
    let jf = "20200102.json"
    loadDoc(jf);
  }, false);

  function loadDoc(jf){
    let xReq = new XMLHttpRequest();
    if(!xReq){
      alert('cannnot make XMLHTTP instance.');
      return false;
    }
    xReq.onreadystatechange = function() {
      if (this.readyState === 4 && this.status === 200) {
        //readystate (0:uninitialized) (1:loading) (2:loaded) (3:interactive) (4:complete)
        //status 200 OK
        let res = JSON.parse(this.responseText).boxOfficeResult.dailyBoxOfficeList;
        console.log(res);
        showBoxoffice(res);
        //document.querySelector(".c-paragraph").innerText = res;
      }
      else{
        document.querySelector(".c-paragraph").innerText = "error in request";
      }
    };
    xReq.open('GET', jf);
    xReq.send();
  }

  function showBoxoffice(arr){
    let output = "<table><thead><tr><th>순위</th><th>작품명</th><th>개봉일</th></tr></thead><tbody>";
    for(let i = 0; i < arr.length; i++) {
      output += '<tr><td class="td1">' + arr[i].rank + '</td><td class="td2">' + arr[i].movieNm + '</td><td class="td3">' + arr[i].openDt + '</td></tr>';
    }
    document.querySelector(".c-paragraph").innerHTML = output + "</tbody></table>";
  }
  </script>
</body>
</html>
